import{j as v,e as i,k as S,l as $,s as l,m as _}from"./alert.153ff9eb.js";const q=n=>{const a=new Date(n*1e3),r=a.getFullYear()+"-",t=(a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1)+"-",e=a.getDate()+" ";return r+t+e},w=document.querySelector("#typeFilter"),u=document.querySelector("#chartTitle");w.addEventListener("change",n=>{d.filter=n.target.value,d.render(d.filter),d.filter==="category"?u.textContent="\u5168\u7522\u54C1\u985E\u5225\u71DF\u6536\u6BD4\u91CD":u.textContent="\u5168\u54C1\u9805\u71DF\u6536\u6BD4\u91CD"});let d={data:[],filter:"",init:function(){v().then(n=>{const{status:a,orders:r,message:t}=n.data;a?(this.data=r,this.render("category"),this.renderTable()):i(t)})},render:function(n="category"){const a=this.data.map(t=>t.products).flat();let r;if(n==="category"){const t=a.map(e=>e.category).reduce((e,s)=>(e[s]?e[s]++:e[s]=1,e),{});r=Object.entries(t)}else if(n==="product"){const t=a.map(e=>e.title).reduce((e,s)=>(e[s]?e[s]++:e[s]=1,e),{});r=Object.entries(t)}this.renderChart(r)},renderChart:function(n){c3.generate({bindto:"#chart",data:{columns:n,type:"pie",labels:!0},bar:{width:50}})},renderTable:function(){const n=document.querySelector("tbody");n.innerHTML="";let a="";this.data.forEach(r=>{const{id:t,paid:e,user:s,products:o,createdAt:c}=r,{name:h,tel:g,email:m,address:p,payment:T}=s,f=o.map(L=>L.title).join("<br>"),b=`<div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" role="switch" id="paid_${t}" data-id="${t}" ${e?"checked":""}>
                                    <label class="form-check-label" for="paid_${t}">${e?"\u5DF2\u4ED8\u6B3E":"\u672A\u4ED8\u6B3E"}</label>
                                    <span class="d-none loading spinner-border spinner-border-sm" role="status"></span>
                                </div>`,y=`<button class="btn btn-danger btn-sm data__remove" data-id="${t}">
                                \u522A\u9664
                                <span class="d-none loading spinner-border spinner-border-sm" role="status"></span>
                            </button>`;a+=`
                <tr>
                    <td>${t}</td>
                    <td>${h} <br/> ${g}</td>
                    <td>${p}</td>
                    <td>${m}</td>
                    <td>${f}</td>
                    <td>${q(c)}</td>
                    <td>${b}</td>
                    <td>${y}</td>
                </tr>
            `}),n.innerHTML=a,this.eventBind()},eventBind:function(){document.querySelectorAll(".data__remove").forEach(t=>{t.addEventListener("click",e=>{const s=e.target.dataset.id;!e.target.querySelector(".loading").classList.contains("d-none")||(this.removeLoading(s,!0),this.remove(s))})}),document.querySelectorAll('[role="switch"]').forEach(t=>{t.addEventListener("change",e=>{if(e.preventDefault(),!e.target.parentNode.querySelector(".loading").classList.contains("d-none"))return;const o=e.target.dataset.id,c=e.target.checked;this.update(o,c)})}),document.querySelector(".data__clear__btn").addEventListener("click",()=>{!document.querySelector(".data__clear__loading").classList.contains("d-none")||(this.clearLoading(!0),this.clear())})},update:function(n,a){S({data:{id:n,paid:a}}).then(r=>{const{status:t,orders:e,message:s}=r.data;t?(this.data=e,this.render("category"),this.renderTable()):i(s)})},updateLoading:function(n,a){const t=document.querySelector(`[data-id="${n}"]`).parentNode.querySelector(".loading");a?t.classList.remove("d-none"):t.classList.add("d-none")},remove:function(n){$(n).then(a=>{const{status:r,orders:t,message:e}=a.data;r?(this.data=t,this.render(),this.renderTable(),l("\u522A\u9664\u6210\u529F"),this.removeLoading(n,!1)):i(e)})},removeLoading:function(n,a){const r=document.querySelector(`.data__remove[data-id="${n}"] .loading`);a?r.classList.remove("d-none"):r.classList.add("d-none")},clear:function(){_().then(n=>{const{status:a,orders:r,message:t}=n.data;a?(this.data=r,this.render(),l("\u6E05\u9664\u6210\u529F"),this.clearLoading(!1)):i(t)})},clearLoading:function(n){const a=document.querySelector("#clearLoading");n?a.classList.remove("d-none"):a.classList.add("d-none")}};d.init();
